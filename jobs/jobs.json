- name: Rebuild jobs.json index
  
  run: |
    set -e
    shopt -s nullglob
    FILES=(jobs/*.json)
    echo "Found ${#FILES[@]} job files."

    if [ ${#FILES[@]} -eq 0 ]; then
      echo "[]" > jobs/jobs.json
    else
      echo "Combining files into jobs.json index..."
      jq -s '[ .[] | del(.descriptionHtml) ]' "${FILES[@]}" > jobs/jobs.json || {
        echo "‚ùå jq failed to parse at least one job file. Dumping contents:"
        cat "${FILES[@]}"
        exit 1
      }
    fi
